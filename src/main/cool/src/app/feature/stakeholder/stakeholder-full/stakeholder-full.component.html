<app-menu-bar [caseId]="caseId" [stakeData]="stakeHolderMapInfo" [offerId]="currentOfferId" [offerName]="offerName"
  (updateMessage)="updateMessage($event)">
</app-menu-bar>

<div class="content">

  <div class="container">



    <div class="panel-wrapper mt-15">

      <app-taskbar (onProceedToNext)="addCollaborator()">
      </app-taskbar>

      <div class="contentBox mt-10">

        <div class="card card--raised base-margin-top">
          <ul class="list">

            <li *ngFor="let key of getKeys(stakeHolderMapInfo)">
              <div *ngIf="key !== 'Stakeholders'">
                <div class="ui-accordion-header"><span class="text-uppercase">{{key}}
                    ({{stakeHolderMapInfo[key].length}})</span></div>
                <div class="ui-accordion-content">
                  <div *ngFor="let coOwners of stakeHolderMapInfo[key]">
                    <div class="flex-center-vertical">
                      <!-- Team Member Name Avatar -->
                      <span class="avatar-ico">
                        <svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 36 36"
                          id="fwt-profile-button-loggedin" role="img">
                          <title id="fwt-profile-button-loggedin-title"></title>
                          <g fill="none" fill-rule="evenodd">
                            <path stroke="#4d4c4c" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                              d="M22.857 31.36c-1.616.614-3.37.95-5.202.95C9.56 32.31 3 25.749 3 17.655S9.561 3 17.655 3 32.31 9.561 32.31 17.655c0 3.988-1.727 7.703-4.31 10.344"
                              x="0" y="0"></path>
                            <text fill="#007493" font-family="CiscoSans, Arial, sans-serif" font-weight="300"
                              font-size="16" x="50%" y="50%" dy=".35em" text-anchor="middle"
                              id="fwt-initials">{{getInitialChar(coOwners['name'])}}</text>
                          </g>
                        </svg>
                      </span>
                      <div class="flex-fluid text-left half-margin-left">
                        <div class="text-bold">{{coOwners['name']}}</div>
                        <div>{{coOwners['email']}}</div>
                      </div>
                    </div>
                    <div class="divider divider--compressed"></div>
                  </div>
                </div>
              </div>
            </li>

            <!-- Here goes stakeholders list-->
            <li>

              <div class="ui-accordion-header"><span class="text-uppercase"> Stakeholders
                  ({{stakeHolderListInfo.length}})</span></div>

              <div class="ui-accordion-content">

                <div class="panel panel--compressed panel--ltgray panel--loose">

                  <span>Add Stakeholders</span>

                  <form [formGroup]="stakeholderForm" (ngSubmit)="onAdd()">

                    <div class="row">
                      <div class="col-md-6">

                        <div class="form-group half-margin-bottom">
                          <div class="form-group__text">
                            <p-autoComplete [(ngModel)]="searchStakeHolderInput" formControlName="userName"
                              class="form-control" [suggestions]="searchStakeHolderResults"
                              (completeMethod)="search($event)" [size]="100" field="userName" [minLength]="3"
                              scrollHeight="150px" placeholder="SEARCH BY STAKEHOLDER NAME" required>
                              <ng-template pTemplate="body" let-stakes>
                                <div>
                                  <span>
                                    {{stakes.userName}} |
                                  </span>
                                  <span>
                                    {{stakes.emailId}} |
                                  </span>
                                  <span>
                                    {{stakes.userMappings[0].functionalRole}}
                                  </span>

                                </div>
                              </ng-template>
                            </p-autoComplete>
                          </div>

                        </div>
                      </div>

                      <div class="col-md-1">
                        <button class="btn btn--primary" type="submit" [disabled]="!stakeholderForm.valid">ADD</button>
                      </div>

                    </div>
                  </form>

                </div>

                <div class="responsive-table base-margin-top">
                  <p-table #dt [columns]="cols" [value]="stakeHolderListInfo" [(selection)]="selectedStakeHolders"
                    [rows]="6">

                    <ng-template pTemplate="header" let-columns>
                      <tr>
                        <th style="width: 2.25em">
                          <p-tableHeaderCheckbox></p-tableHeaderCheckbox>
                        </th>
                        <th *ngFor="let col of columns">
                          {{col.header}}
                        </th>
                      </tr>
                    </ng-template>

                    <ng-template pTemplate="body" let-stakeholder>
                      <tr>
                        <td>
                          <p-tableCheckbox [value]="stakeholder" *ngIf="canUserDeleteStakeHolder(stakeholder)">
                          </p-tableCheckbox>
                        </td>
                        <td>{{stakeholder.name}}</td>
                        <td>{{stakeholder.email}}</td>
                        <td>
                          {{stakeholder.functionalRole}}
                          <span *ngIf="canUserDeleteStakeHolder(stakeholder)" class="icon-trash icon-small pull-right"
                            (click)="deleteStakeHolder(stakeholder._id)"></span>
                        </td>
                      </tr>
                    </ng-template>

                  </p-table>
                </div>

              </div>
            </li>

          </ul>

          <div class="col-md-12 base-margin-top">
            <button class="btn btn--primary" (click)="delteSelectedStakeHolders()">REMOVE</button>
          </div>

        </div>

      </div>
      <div class="base-margin-top"></div>
    </div>
  </div>
</div>
