<div class="fin-container">

  <div class="approval-buttons" *ngIf="viewMode && UiUtil.statusIsPending(rule.status)" finAuth="bizadmin">
    <button type="button" cuiButton color="primary" (click)="approve()">Approve</button>
    <button type="button" cuiButton color="primary" (click)="reject()">Reject</button>
    <button type="button" cuiButton color="secondary" (click)="cancel()">Cancel</button>
  </div>

  <form #form="ngForm" [class.disabled]="viewMode">

    <div class="row" style="margin-top:5px; margin-bottom:23px;">
      <div class="col-lg-6">
        <fin-input name="name" type="text" [(ngModel)]="rule.name" label="Rule Name" [notInList]="ruleNames"
                   notInListMessage="Rule name already exists" [required]="true" [disabled]="editMode"></fin-input>
        <cui-select name="driver" [(ngModel)]="rule.driverName" [items]="drivers" label="Driver"
                    optionsKey="name" optionsValue="value" [required]="true"></cui-select>
      </div>
      <div class="col-lg-6">
        <div fxLayout="row" fxLayoutAlign="center start" class="status-section">
          <div *ngIf="rule.approvedOnce === 'Y'" class="form-group-check">
            <fin-checkbox name="status" label="Active" [(model)]="rule.activeStatus" trueVal="A" falseVal="I"></fin-checkbox>
          </div>
          <div class="form-group-text" style="margin-left:30px;">Status: {{UiUtil.getStatusText(rule.status)}}</div>
        </div>
        <cui-select name="period" [(ngModel)]="rule.period" [items]="periods" label="Driver Period" dropdownMaxHeight="220px"
                    [required]="true" optionsKey="period" optionsValue="period"></cui-select>
      </div>
    </div>
    <br>

    <div class="row">
      <div class="col-lg-6">
        <div class="form-group-max-width">
          <div class="border-outline">
            <div style="margin-bottom:-10px;">
              <div class="left text-center half-margin-bottom form-group-max-width">Matching Criteria</div>
                <cui-select name="salesMatch" [(ngModel)]="rule.salesMatch" [items]="salesMatches" label="Sales" empty="true"
                            optionsKey="match" optionsValue="match"></cui-select>
                <cui-select name="productMatch" [disabled]="!!rule.beMatch" [(ngModel)]="rule.productMatch" [items]="productMatches" label="Product"
                            empty="true" optionsKey="match" optionsValue="match"></cui-select>
                <cui-select name="scmsMatch" [(ngModel)]="rule.scmsMatch" [items]="scmsMatches" label="SCMS"
                            empty="true" optionsKey="match" optionsValue="match"></cui-select>
                <cui-select name="beMatch" [disabled]="!!rule.productMatch" [(ngModel)]="rule.beMatch" [items]="beMatches" label="Internal Business Entity"
                            empty="true" optionsKey="match" optionsValue="match"></cui-select>
                <cui-select name="leMatch" [(ngModel)]="rule.legalEntityMatch" [items]="legalEntityMatches" label="Legal Entity"
                            empty="true" optionsKey="match" optionsValue="match"></cui-select>
            </div>
          </div>
        </div>
      </div>

      <div class="col-lg-6 conditional-div">
        <div class="form-group-max-width">
          <div class="border-outline">
            <div style="margin-bottom:-10px;">
                <div class="right text-center half-margin-bottom form-group-max-width">Selection Criteria</div>
                <div class="row">
                  <div class="col-1">
                    <div class="form-group-text">SL1</div>
                    <div class="form-group-text">SL2</div>
                    <div class="form-group-text">SL3</div>
                    <div class="form-group-text">TG</div>
                    <div class="form-group-text">BU</div>
                    <div class="form-group-text">PF</div>
                    <div class="form-group-text">SCMS</div>
                    <div class="form-group-text">BE</div>
                  </div>
                  <div class="col-3">
                    <cui-select name="salesSL1Cond" class="replace-label-space" [(ngModel)]="rule.salesSL1CritCond" [items]="conditionalOperators"
                                empty="true" [required]="!!rule.salesSL1CritChoices.length" optionsKey="operator" optionsValue="operator"></cui-select>
                    <cui-select name="salesSL2Cond" class="replace-label-space" [(ngModel)]="rule.salesSL2CritCond" [items]="conditionalOperators"
                                empty="true" [required]="!!rule.salesSL2CritChoices.length" optionsKey="operator" optionsValue="operator"></cui-select>
                    <cui-select name="salesSL3Cond" class="replace-label-space" [(ngModel)]="rule.salesSL3CritCond" [items]="conditionalOperators"
                                empty="true" [required]="!!rule.salesSL3CritChoices.length" optionsKey="operator" optionsValue="operator"></cui-select>
                    <cui-select name="prodTGCond" class="replace-label-space" [(ngModel)]="rule.prodTGCritCond" [items]="conditionalOperators"
                                empty="true" [required]="!!rule.prodTGCritChoices.length" optionsKey="operator" optionsValue="operator"></cui-select>
                    <cui-select name="prodBUCond" class="replace-label-space" [(ngModel)]="rule.prodBUCritCond" [items]="conditionalOperators"
                                empty="true" [required]="!!rule.prodBUCritChoices.length" optionsKey="operator" optionsValue="operator"></cui-select>
                    <cui-select name="prodPFCond" class="replace-label-space" [(ngModel)]="rule.prodPFCritCond" [items]="conditionalOperators"
                                empty="true" [required]="!!rule.prodPFCritChoices.length" optionsKey="operator" optionsValue="operator"></cui-select>
                    <cui-select name="scmsCond" class="replace-label-space" [(ngModel)]="rule.scmsCritCond" [items]="conditionalOperators"
                                empty="true" [required]="!!rule.scmsCritChoices.length" optionsKey="operator" optionsValue="operator"></cui-select>
                    <cui-select name="beCond" class="replace-label-space" [(ngModel)]="rule.beCritCond" [items]="conditionalOperators"
                                empty="true" [required]="!!rule.beCritChoices.length" optionsKey="operator" optionsValue="operator"></cui-select>
                  </div>
                  <div class="col-8">
                    <cui-multiselect name="sl1SalesChoice" [(ngModel)]="rule.salesSL1CritChoices" [items]="salesSL1Choices"
                                     class="replace-label-space" optionsKey="name" optionsValue="name" empty="true"></cui-multiselect>
                    <fin-input name="sl2SalesChoice" [(ngModel)]="rule.salesSL2CritChoices" [ngModelOptions]="{updateOn: 'blur'}"
                               class="replace-label-space" placeholder="comma separated values"
                               [stringToArray]="true" [options]="salesSL2ChoiceOptions"></fin-input>
                    <fin-input name="sl3SalesChoice" [(ngModel)]="rule.salesSL3CritChoices" [ngModelOptions]="{updateOn: 'blur'}"
                               class="replace-label-space" placeholder="comma separated values"
                               [stringToArray]="true" [options]="salesSL3ChoiceOptions"></fin-input>
                    <cui-multiselect name="prodTGChoice" [(ngModel)]="rule.prodTGCritChoices" [items]="prodTgChoices" optionsKey="name"
                                     class="replace-label-space" optionsValue="name" dropdownMaxHeight="300"
                                     empty="true"></cui-multiselect>
                    <fin-input name="prodBUChoice" [(ngModel)]="rule.prodBUCritChoices" [ngModelOptions]="{updateOn: 'blur'}"
                               class="replace-label-space" placeholder="comma separated values"
                               [stringToArray]="true" [options]="prodBUChoiceOptions"></fin-input>
                    <fin-input name="prodPFChoice" [(ngModel)]="rule.prodPFCritChoices" [ngModelOptions]="{updateOn: 'blur'}"
                               class="replace-label-space" placeholder="comma separated values"
                               [stringToArray]="true" [options]="prodPFChoiceOptions"></fin-input>
                    <cui-multiselect name="scmsChoice" [(ngModel)]="rule.scmsCritChoices" [items]="scmsChoices" optionsKey="name"
                                     class="replace-label-space" optionsValue="name" empty="true"></cui-multiselect>
                    <cui-multiselect name="beChoice" [(ngModel)]="rule.beCritChoices" [items]="internalBeChoices" optionsKey="name"
                                 optionsValue="name" dropdownMaxHeight="300"
                                     class="replace-label-space" empty="true"></cui-multiselect>
                  </div>
                </div>
            </div>
          </div>
        </div>
      </div>

    </div>

    <div *ngIf="!viewMode" finAuth="super-user" class="fin-footer-buttons">
      <button type="submit" finErrorFlash cuiButton color="primary" (click)="submitForApproval()">Submit</button>
      <button type="button" finErrorFlash cuiButton color="primary" (click)="saveToDraft()">Save as Draft</button>
      <button type="button" cuiButton color="secondary" (click)="cancel()">Cancel</button>
      <button type="button" cuiButton color="secondary" (click)="reset()">Reset</button>
    </div>

    <div *ngIf="viewMode"><br><br></div>

<!--
    <div>form.valid: {{form.valid}}</div>
    <div>form.invalid: {{form.invalid}}</div>
    <div>form.pending: {{form.pending}}</div>
-->

  </form>
</div>
