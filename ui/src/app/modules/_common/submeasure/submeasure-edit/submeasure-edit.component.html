<div class="fin-container">

  <div class="approval-buttons" *ngIf="viewMode && UiUtil.statusIsPending(sm.status)" finAuth="bizadmin">
    <button type="button" cuiButton color="primary" (click)="approve()">Approve</button>
    <button type="button" cuiButton color="primary" (click)="reject()">Reject</button>
    <button type="button" cuiButton color="secondary" (click)="cancel()">Cancel</button>
  </div>

  <form #form="ngForm" [class.disabled]="viewMode">
    <div class="row">

      <div class="col-lg-6">
        <cui-select name="measure" [(ngModel)]="sm.measureId" [items]="measures" label="Measure*" empty="true" [required]="true"
                    optionsKey="name" optionsValue="measureId" (ngModelChange)="measureChange()"></cui-select>
        <fin-input name="name" [(ngModel)]="sm.name" [disabled]="editMode" type="text" label="Sub-Measure Name"
                   [notInList]="submeasureNames" notInListMessage="Submeasure name already exists" [required]="true" (blur)="updateReportingLevel3()"></fin-input>
        <cui-select name="source" [(ngModel)]="sm.sourceId" [items]="measureSources" label="Source*" empty="true" [disabled]="!sm.measureId"
                    optionsKey="name" optionsValue="sourceId" [required]="true" (ngModelChange)=sourceChange()></cui-select>
        <fin-input name="desc" [textarea]="true" [(ngModel)]="sm.desc" label="Description" [rows]="2" [required]="true"></fin-input>
      </div>

      <div class="col-lg-6 form-group-max-width">
        <div fxLayout="row" fxLayoutAlign="center start" class="status-section">
          <div *ngIf="sm.approvedOnce === 'Y'" class="form-group-check form-group-inline-30">
            <fin-checkbox label="Active" [(model)]="sm.activeStatus" trueVal="A" falseVal="I"></fin-checkbox>
          </div>
          <div class="form-group-text" style="margin-left:30px;">Status: {{UiUtil.getStatusText(sm.status)}}</div>
        </div>

        <cui-select name="category" [(ngModel)]="sm.categoryType" [disabled]="disableCategories" [items]="categoryTypes"
                    label="Submeasure Category Type" empty="true" optionsKey="name" optionsValue="value" [required]="true"></cui-select>
        <div *ngIf="sm.categoryType === 'MM'" fxLayout="row" fxLayoutAlign="start start">
          <div class="form-group-text form-group-inline-30">Manual Mix HW/SW:</div>
          <fin-input name="manualMixHw" label="HW" [(ngModel)]="sm.manualMixHw" [required]="true" [inline]="true" class="hwsw-inputs"></fin-input>
          <fin-input name="manualMixSw" label="SW" [(ngModel)]="sm.manualMixSw" [required]="true" [inline]="true" class="hwsw-inputs"></fin-input>
        </div>

        <cui-select *ngIf="sm.measureId === 5" [disabled]="sm.sourceId !== 2" name="flashCategory" [(ngModel)]="flashCategory" [items]="flashCategories" label="MRAP - Flash Category Id*" empty="true" [required]="true" optionsKey="mrap_category_id" optionsValue="adj_type_id"></cui-select>
        <cui-select *ngIf="sm.measureId === 1"  [disabled]="sm.sourceId !== 1" name="adjustmentType" [(ngModel)]="adjustmentType" [items]="adjustmentTypes" label="Adjustment Type*" empty="true" [required]="true" optionsKey="rrr_category_id" optionsValue="adj_type_id"></cui-select>

        <div class="margin-top:15px; height: 0px;">&nbsp;</div>
        <div class="border-outline">
          <div style="margin-bottom:-10px;">
            <div class="row" style="margin-top:1px; margin-bottom:15px;">
              <div class="col-6">
                <fin-checkbox label="Is Group Submeasure" [(model)]="sm.indicators.groupFlag" trueVal="Y" falseVal="N" [inline]="true"
                              [disabled]="!!sm.groupingSubmeasureId"></fin-checkbox>
              </div>
              <div class="col-6">
                <fin-checkbox label="Is Service Submeasure" [(model)]="sm.indicators.service" trueVal="Y" falseVal="N"
                              [inline]="true" [disabled]="sm.groupingSubmeasureId"></fin-checkbox>
              </div>
            </div>
            <cui-select name="groupingSubmeasure" [(ngModel)]="sm.groupingSubmeasureId" [items]="groupingSubmeasures"
                        label="Grouping Submeasure" empty="true" optionsKey="name"
                        optionsValue="submeasureId" [disabled]="sm.indicators.groupFlag === 'Y'"></cui-select>
          </div>
        </div>
      </div>
    </div>

    <br>

    <div class="row" style="margin-top:30px;">

      <div class="col-lg-6  ifl-left-side">
        <div class="form-group-max-width">
          <div class="border-outline">
              <fieldset class="input-filter-level">
                <legend>Business Input Level*</legend>
                <div class="row half-padding">
                  <div class="col-6">
                    <div class="left text-center">Hierarchy</div>
                  </div>
                  <div class="col-6">
                    <div class="right text-center">Level</div>
                  </div>
                </div>
                <div class="row ifl-section">
                  <div class="col-6">
                    <div class="check-wrap">
                      <fin-checkbox [(model)]="ifl_switch_ibe" label="Internal Business Entity"
                                    (modelChange)="iflChange('ibe')" [disabled]="BeIflDisabled"></fin-checkbox>
                    </div>
                    <div class="check-wrap">
                      <fin-checkbox [(model)]="ifl_switch_p" label="Product" (modelChange)="iflChange('p')" [disabled]="ProductIflDisabled"></fin-checkbox>
                    </div>
                    <div class="check-wrap">
                      <fin-checkbox [(model)]="ifl_switch_le" label="Legal Entity" (modelChange)="iflChange('le')" [disabled]="LegalIflDisabled"></fin-checkbox>
                    </div>
                    <div class="check-wrap">
                      <fin-checkbox [(model)]="ifl_switch_s" label="Sales" (modelChange)="iflChange('s')" [disabled]="SalesIflDisabled"></fin-checkbox>
                    </div>
                    <div class="check-wrap">
                      <fin-checkbox [(model)]="ifl_switch_scms" label="SCMS" (modelChange)="iflChange('scms')" [disabled]="ScmsIflDisabled"></fin-checkbox>
                    </div>
                  </div>
                  <div class="col-6">
                    <div class="sel-wrap">
                      <cui-select name="ibeLevel" [(ngModel)]="sm.inputFilterLevel.internalBELevel" [fxShow]="ifl_switch_ibe" class="option"
                                  [items]="ibe_items" optionsKey="name"optionsValue="value" empty="true"></cui-select>
                    </div>
                    <div class="sel-wrap">
                      <cui-select name="productLevel" [(ngModel)]="sm.inputFilterLevel.productLevel" [fxShow]="ifl_switch_p" class="option"
                                  [items]="p_items" optionsKey="name" optionsValue="value" empty="true"></cui-select>
                    </div>
                    <div class="sel-wrap">
                      <cui-select name="entityLevel" [(ngModel)]="sm.inputFilterLevel.entityLevel" [fxShow]="ifl_switch_le" class="option"
                                  [items]="le_items" optionsKey="name" optionsValue="value" empty="true"></cui-select>
                    </div>
                    <div class="sel-wrap">
                      <cui-select name="salesLevel" [(ngModel)]="sm.inputFilterLevel.salesLevel" [fxShow]="ifl_switch_s" class="option"
                                  [items]="s_items" optionsKey="name" optionsValue="value" empty="true"></cui-select>
                    </div>
                    <div class="sel-wrap">
                      <cui-select name="scmsLevel" [(ngModel)]="sm.inputFilterLevel.scmsLevel" [fxShow]="ifl_switch_scms" class="option"
                                  [items]="scms_items" optionsKey="name" optionsValue="value" empty="true"></cui-select>
                    </div>
                  </div>
                </div>
              </fieldset>
          </div>
        </div>
      </div>

      <div class="col-lg-6 mm-right-side">
        <div class="form-group-max-width">
          <div class="border-outline">
        <fieldset class="input-filter-level mm-fieldset">
          <legend>
            <fin-checkbox class="legend-checkbox" [(model)]="sm.indicators.manualMapping"
                          trueVal="Y" falseVal="N" (modelChange)="mmSelect()"></fin-checkbox>
            Manual Mapping
          </legend>

          <div>
            <div class="row half-padding">
              <div class="col-6">
                <div class="left text-center">Hierarchy</div>
              </div>
              <div class="col-6">
                <div class="right text-center">Level</div>
              </div>
            </div>
            <div class="row ifl-section"  [class.disabled]="!isManualMapping()">
              <div class="col-6">
                <div class="check-wrap">
                  <fin-checkbox [(model)]="mm_switch_ibe" label="Internal Business Entity"
                                (modelChange)="mmChange('ibe')" [disabled]="BeMmDisabled"></fin-checkbox>
                </div>
                <div class="check-wrap">
                  <fin-checkbox [(model)]="mm_switch_p" label="Product" (modelChange)="mmChange('p')" [disabled]="ProductMmDisabled"></fin-checkbox>
                </div>
                <div class="check-wrap">
                  <fin-checkbox [(model)]="mm_switch_le" label="Legal Entity" (modelChange)="mmChange('le')" [disabled]="LegalMmDisabled"></fin-checkbox>
                </div>
                <div class="check-wrap">
                  <fin-checkbox [(model)]="mm_switch_s" label="Sales" (modelChange)="mmChange('s')" [disabled]="SalesMmDisabled"></fin-checkbox>
                </div>
                <div class="check-wrap">
                  <fin-checkbox [(model)]="mm_switch_scms" label="SCMS" (modelChange)="mmChange('scms')" [disabled]="ScmsMmDisabled"></fin-checkbox>
                </div>
              </div>
              <div class="col-6">
                <div class="sel-wrap">
                  <cui-select name="ibeLevelMM" [(ngModel)]="sm.manualMapping.internalBELevel" [fxShow]="mm_switch_ibe" class="option"
                              [items]="ibe_items" optionsKey="name" optionsValue="value" empty="true"></cui-select>
                </div>
                <div class="sel-wrap">
                  <cui-select name="productLevelMM" [(ngModel)]="sm.manualMapping.productLevel" [fxShow]="mm_switch_p" class="option"
                              [items]="p_items" optionsKey="name" optionsValue="value" empty="true"></cui-select>
                </div>
                <div class="sel-wrap">
                  <cui-select name="entityLevelMM" [(ngModel)]="sm.manualMapping.entityLevel" [fxShow]="mm_switch_le" class="option"
                              [items]="le_items" optionsKey="name" optionsValue="value" empty="true"></cui-select>
                </div>
                <div class="sel-wrap">
                  <cui-select name="salesLevelMM" [(ngModel)]="sm.manualMapping.salesLevel" [fxShow]="mm_switch_s" class="option"
                              [items]="s_items" optionsKey="name" optionsValue="value" empty="true"></cui-select>
                </div>
                <div class="sel-wrap">
                  <cui-select name="scmsLevelMM" [(ngModel)]="sm.manualMapping.scmsLevel" [fxShow]="mm_switch_scms" class="option"
                              [items]="scms_items" optionsKey="name" optionsValue="value" empty="true"></cui-select>
                </div>
              </div>
            </div>
          </div>
        </fieldset>
      </div>
    </div>`
      </div>

    </div>

    <div class="row" style="margin-top:30px;">
      <div class="col-lg-6">
        <cui-select name="startMonth" [(ngModel)]="sm.startFiscalMonth" [items]="yearmos" label="Effective Month*" empty="true"
                    [required]="true" optionsKey="fiscalMonthName" optionsValue="fiscalMonth"></cui-select>

        <cui-select name="processingTime" [(ngModel)]="sm.processingTime" [items]="timings" label="Processing Timing" empty="true"
                    optionsKey="name" optionsValue="name"></cui-select>

        <cui-select name="pnlnodeGrouping" [(ngModel)]="sm.pnlnodeGrouping" [items]="groupings" label="P&L Node Grouping" empty="true"
                    optionsKey="name" optionsValue="value"></cui-select>
      </div>
      <div class="col-lg-6">
        <fin-input name="reportingLevel{{level}}" type="text" *ngFor="let level of [1,2,3]; let idx=index;"
                   [(ngModel)]="sm.reportingLevels[idx]"
                   [disabled]="!currentMeasure.reportingLevelEnableds[idx]" label="Reporting Level {{level}}"></fin-input>
      </div>
    </div>

    <div class="row base-padding-top">
      <div class="col-lg-6">
        <fieldset class="rule-assoc">
          <legend>
        <span class="tooltip" data-balloon="Attach up to 5 rules" data-balloon-pos="up">
        <i class="icon-info-outline icon-small"></i>
          </span>
            Rule Association
          </legend>

          <div class="rule" *ngFor="let rule of arrRules; let idx = index;">
            <cui-select name="rule{{idx}}" [(ngModel)]="sm.rules[idx]" class="rule-select" [items]="rules" empty="true" dropdownMaxHeight="300"
                        optionsKey="name" optionsValue="name"></cui-select>

            <i class="delete icon-exit-outline icon-small" [fxShow]="showDeleteRuleIcon()" (click)="removeRule(idx)"></i>
            <i class="add icon-add-outline icon-small" [fxShow]="showAddRuleIcon()" (click)="addRule(idx)"></i>
          </div>
        </fieldset>
      </div>
    </div>

    <div class="row">
      <div class="col-12">
        <div class="inline-check-row">
          <div class="form-group-check form-group-inline-30">
            <fin-checkbox label="Retained Earnings" [(model)]="sm.indicators.retainedEarnings" trueVal="Y"
                          falseVal="N"></fin-checkbox>
          </div>
          <div class="form-group-check form-group-inline-30">
            <fin-checkbox label="Transition" [(model)]="sm.indicators.transition" trueVal="Y" falseVal="N"></fin-checkbox>
          </div>
          <div class="form-group-check form-group-inline-30">
            <fin-checkbox label="Corporate Revenue" [(model)]="sm.indicators.corpRevenue" trueVal="Y"
                          falseVal="N"></fin-checkbox>
          </div>
          <div class="form-group-check form-group-inline-30">
            <fin-checkbox label="2 Tier" [(model)]="sm.indicators.twoTier" trueVal="Y" falseVal="N"></fin-checkbox>
          </div>
          <div class="form-group-check form-group-inline-30">
            <fin-checkbox label="Dual Gaap" [(model)]="sm.indicators.dualGaap" trueVal="Y" falseVal="N"></fin-checkbox>
          </div>
        </div>
      </div>
    </div>

    <div *ngIf="!viewMode" finAuth="super-user" class="fin-footer-buttons">
      <button type="submit" finErrorFlash cuiButton color="primary" (click)="submitForApproval()">Submit</button>
      <button type="button" cuiButton color="primary" (click)="saveToDraft()">Save Draft</button>
      <button type="button" cuiButton color="secondary" (click)="cancel()">Cancel</button>
      <button type="button" cuiButton color="secondary" (click)="reset()">Reset</button>
    </div>

    <div *ngIf="viewMode"><br><br></div>

  </form>
</div>
