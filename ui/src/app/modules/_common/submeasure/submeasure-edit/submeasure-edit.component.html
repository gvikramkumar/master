
<div class="fin-edit-container">

  <div class="row">

    <div class="col-md-6">
      <cui-select [items]="measures" label="Measure" empty="true" [(ngModel)]="sm.measureId" required="true"
                  optionsKey="name" optionsValue="measureId" (selectChange)="measureChange()"></cui-select>
    </div>

    <div class="col-md-6">
      <div fxLayout="row" fxLayoutAlign="center start">
        <div *ngIf="!UiUtil.statusIsPending(sm.status)" class="form-group-check">
          <fin-checkbox label="Active" [(model)]="sm.status" trueVal="A" falseVal="I"></fin-checkbox>
        </div>
        <div *ngIf="UiUtil.statusIsPending(sm.status)" class="form-group-button">
          <button cuiButton [small]="true" color="primary">Approve</button>
          <button cuiButton [small]="true" color="primary">Reject</button>
        </div>
      </div>
    </div>

  </div>

  <div class="row">
    <div class="col-md-6">
      <cui-input [disabled]="this.editMode" type="text" [(model)]="sm.name" label="Sub-Measure Name"
                 required="true"></cui-input>
    </div>
    <div class="col-md-6">
      <cui-select [items]="sources" label="Source" empty="true"
                  optionsKey="name" optionsValue="sourceId" [(ngModel)]="sm.sourceId"></cui-select>
    </div>
  </div>

  <div class="row">
    <div class="col-md-6">
      <cui-input type="textarea" [(model)]="sm.desc" label="Description" [options]="{rows: 2}"></cui-input>
    </div>
    <div class="col-md-6" style="padding-top:14px;">
      <cui-select [disabled]="disableCategories" [items]="categoryTypes"
                  label="Submeasure Category Type" empty="true" optionsKey="name"
                  optionsValue="value" [(ngModel)]="sm.categoryType"></cui-select>
    </div>
  </div>
  <br>

  <div class="row half-padding-top">

    <div class="col-md-6 ifl-left-side">
      <fieldset class="input-filter-level">
        <legend>Business Input Level*</legend>
        <div class="row half-padding">
          <div class="col-6">
            <div class="left text-center">Hierarchy</div>
          </div>
          <div class="col-6">
            <div class="right text-center">Level</div>
          </div>
        </div>
        <div class="row ifl-section">
          <div class="col-6">
            <div class="check-wrap">
              <fin-checkbox [(model)]="ifl_switch_ibe" label="Internal Business Entity"
                            (modelChange)="iflChange('ibe')"></fin-checkbox>
            </div>
            <div class="check-wrap">
              <fin-checkbox [(model)]="ifl_switch_p" label="Product" (modelChange)="iflChange('p')"></fin-checkbox>
            </div>
            <div class="check-wrap">
              <fin-checkbox [(model)]="ifl_switch_le" label="Legal Entity"></fin-checkbox>
            </div>
            <div class="check-wrap">
              <fin-checkbox [(model)]="ifl_switch_s" label="Sales"></fin-checkbox>
            </div>
            <div class="check-wrap">
              <fin-checkbox [(model)]="ifl_switch_scms" label="SCMS"></fin-checkbox>
            </div>
          </div>
          <div class="col-6">
            <div class="sel-wrap">
              <cui-select [fxShow]="ifl_switch_ibe" class="option" [items]="ibe_items" optionsKey="name"
                          optionsValue="value" [(ngModel)]="sm.inputFilterLevel.internalBELevel"></cui-select>
            </div>
            <div class="sel-wrap">
              <cui-select [fxShow]="ifl_switch_p" class="option" [items]="p_items" optionsKey="name"
                          optionsValue="value" [(ngModel)]="sm.inputFilterLevel.productLevel"></cui-select>
            </div>
            <div class="sel-wrap">
              <cui-select [fxShow]="ifl_switch_le" class="option" [items]="le_items" optionsKey="name"
                          optionsValue="value" [(ngModel)]="sm.inputFilterLevel.entityLevel"></cui-select>
            </div>
            <div class="sel-wrap">
              <cui-select [fxShow]="ifl_switch_s" class="option" [items]="s_items" optionsKey="name"
                          optionsValue="value" [(ngModel)]="sm.inputFilterLevel.salesLevel"></cui-select>
            </div>
            <div class="sel-wrap">
              <cui-select [fxShow]="ifl_switch_scms" class="option" [items]="scms_items" optionsKey="name"
                          optionsValue="value" [(ngModel)]="sm.inputFilterLevel.scmsLevel"></cui-select>
            </div>
          </div>
        </div>
      </fieldset>
    </div>

    <div class="col-md-6 mm-right-side">
      <fieldset class="input-filter-level mm-fieldset">
        <legend>
          <fin-checkbox class="legend-checkbox" [(model)]="sm.indicators.manualMapping"
          trueVal="Y" falseVal="N"></fin-checkbox>
          Manual Mapping
        </legend>

        <div [fxShow]="isManualMapping()">
          <div class="row half-padding">
            <div class="col-6">
              <div class="left text-center">Hierarchy</div>
            </div>
            <div class="col-6">
              <div class="right text-center">Level</div>
            </div>
          </div>
          <div class="row ifl-section">
            <div class="col-6">
              <div class="check-wrap">
                <fin-checkbox [(model)]="mm_switch_ibe" label="Internal Business Entity"
                              (modelChange)="mmChange('ibe')"></fin-checkbox>
              </div>
              <div class="check-wrap">
                <fin-checkbox [(model)]="mm_switch_p" label="Product" (modelChange)="mmChange('p')"></fin-checkbox>
              </div>
              <div class="check-wrap">
                <fin-checkbox [(model)]="mm_switch_le" label="Legal Entity"></fin-checkbox>
              </div>
              <div class="check-wrap">
                <fin-checkbox [(model)]="mm_switch_s" label="Sales"></fin-checkbox>
              </div>
              <div class="check-wrap">
                <fin-checkbox [(model)]="mm_switch_scms" label="SCMS"></fin-checkbox>
              </div>
            </div>
            <div class="col-6">
              <div class="sel-wrap">
                <cui-select [fxShow]="mm_switch_ibe" class="option" [items]="ibe_items" optionsKey="name"
                            optionsValue="value" [(ngModel)]="sm.manualMapping.internalBELevel"></cui-select>
              </div>
              <div class="sel-wrap">
                <cui-select [fxShow]="mm_switch_p" class="option" [items]="p_items" optionsKey="name"
                            optionsValue="value" [(ngModel)]="sm.manualMapping.productLevel"></cui-select>
              </div>
              <div class="sel-wrap">
                <cui-select [fxShow]="mm_switch_le" class="option" [items]="le_items" optionsKey="name"
                            optionsValue="value" [(ngModel)]="sm.manualMapping.entityLevel"></cui-select>
              </div>
              <div class="sel-wrap">
                <cui-select [fxShow]="mm_switch_s" class="option" [items]="s_items" optionsKey="name"
                            optionsValue="value" [(ngModel)]="sm.manualMapping.salesLevel"></cui-select>
              </div>
              <div class="sel-wrap">
                <cui-select [fxShow]="mm_switch_scms" class="option" [items]="scms_items" optionsKey="name"
                            optionsValue="value" [(ngModel)]="sm.manualMapping.scmsLevel"></cui-select>
              </div>
            </div>
          </div>
        </div>
      </fieldset>
    </div>

  </div>

  <div class="row">
    <div class="col-md-6">
      <cui-select [items]="yearmos" label="Effective Month" empty="true" [(ngModel)]="sm.startFiscalMonth"
                  required="true" optionsKey="long" optionsValue="num"></cui-select>

      <cui-select [items]="timings" label="Processing Timing" empty="true" [(ngModel)]="sm.processingTime"
                  optionsKey="name" optionsValue="value"></cui-select>

      <cui-select [items]="groupings" label="P&L Node Grouping" empty="true" [(ngModel)]="sm.pnlnodeGrouping"
                  optionsKey="name" optionsValue="value"></cui-select>
    </div>
    <div class="col-md-6">
      <cui-input type="text" [(model)]="sm.reportingLevels[0]" [disabled]="disableLvl1" label="Reporting Level 1"></cui-input>
      <cui-input type="text" [(model)]="sm.reportingLevels[1]" [disabled]="disableLvl2" label="Reporting Level 2"></cui-input>
      <cui-input type="text" [(model)]="sm.reportingLevels[2]" [disabled]="disableLvl3" label="Reporting Level 3"></cui-input>
    </div>
  </div>

  <div class="row base-padding-top">
    <div class="col-md-6">
      <fieldset class="rule-assoc">
        <legend>
      <span class="tooltip" data-balloon="Attach up to 5 rules" data-balloon-pos="up">
      <i class="icon-info-outline icon-small"></i>
        </span>
          Rule Association
        </legend>

        <div class="rule" *ngFor="let rule of sm.rules; let i = index;">
          <cui-select class="rule-select" [items]="rules" empty="true" dropdownMaxHeight="300"
                      [(ngModel)]="sm.rules[i]" optionsKey="name" optionsValue="name"></cui-select>

          <i class="delete icon-exit-outline icon-small" [fxShow]="showDeleteRuleIcon()" (click)="removeRule(i)"></i>
          <i class="add icon-add-outline icon-small" [fxShow]="showAddRuleIcon()" (click)="addRule(i)"></i>
        </div>
      </fieldset>
    </div>
  </div>

  <div class="fin-footer-buttons">
    <button cuiButton color="primary" small="true" (click)="save()">Submit</button>
    <button cuiButton color="secondary" small="true" (click)="cancel()">Cancel</button>
    <button cuiButton color="secondary" small="true" (click)="reset()">Reset</button>
  </div>

</div>
