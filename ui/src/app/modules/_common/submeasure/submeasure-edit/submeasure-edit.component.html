<div class="fin-edit-container">
  <form #form="ngForm" finAuthDisable="end-user">
    <div class="row">

      <div class="col-lg-6">
        <cui-select name="measure" [(ngModel)]="sm.measureId" [items]="measures" label="Measure" empty="true" [required]="true"
                    optionsKey="name" optionsValue="measureId" (selectChange)="measureChange()"></cui-select>
      </div>

      <div class="col-lg-6">
        <div fxLayout="row" fxLayoutAlign="center center">
          <div *ngIf="sm.approvedOnce === 'Y'" class="form-group-check form-group-inline-30">
            <fin-checkbox label="Active" [(model)]="sm.activeStatus" trueVal="A" falseVal="I"></fin-checkbox>
          </div>
          <div *ngIf="UiUtil.statusIsPending(sm.status)" finAuth="bizadmin" class="form-group-button">
            <button type="button" cuiButton color="primary" (click)="approve()">Approve</button>
            <button type="button" cuiButton color="primary" (click)="reject()">Reject</button>
          </div>
        </div>
      </div>

    </div>

    <div class="row">
      <div class="col-lg-6">
        <fin-input name="name" [(ngModel)]="sm.name" [disabled]="this.editMode" type="text" label="Sub-Measure Name"
                   [notInList]="submeasureNames" notInListMessage="Submeasure name already exists" [required]="true"></fin-input>
      </div>
      <div class="col-lg-6">
        <cui-select name="source" [(ngModel)]="sm.sourceId" [items]="sources" label="Source" empty="true"
                    optionsKey="name" optionsValue="sourceId" [required]="true" (selectChange)=sourceChange()></cui-select>
      </div>
    </div>

    <div class="row">
      <div class="col-lg-6">
        <cui-input type="textarea" [(model)]="sm.desc" label="Description" [options]="{rows: 2}"></cui-input>
        <cui-select name="groupingSubmeasure" [(ngModel)]="sm.groupingSubmeasureId" [items]="groupingSubmeasures"
                    label="Grouping Submeasure" empty="true" optionsKey="submeasureName"
                    optionsValue="submeasureId" [disabled]="sm.indicators.groupFlag === 'Y'"></cui-select>
      </div>
      <div class="col-lg-6" style="padding-top:14px;">
        <cui-select name="category" [(ngModel)]="sm.categoryType" [disabled]="disableCategories" [items]="categoryTypes"
                    label="Submeasure Category Type" empty="true" optionsKey="name" optionsValue="value" [required]="true"></cui-select>
        <div class="form-group-check">
          <fin-checkbox label="Is Group" [(model)]="sm.indicators.groupFlag" trueVal="Y" falseVal="N" [inline]="true"
                        [disabled]="sm.groupingSubmeasureId"></fin-checkbox>
          <fin-checkbox label="Is Service" [(model)]="sm.indicators.service" trueVal="Y" falseVal="N" [inline]="true"></fin-checkbox>
        </div>
      </div>
    </div>
    <br>

    <div class="row half-padding-top">

      <div class="col-lg-6  ifl-left-side">
        <fieldset class="input-filter-level">
          <legend>Business Input Level*</legend>
          <div class="row half-padding">
            <div class="col-6">
              <div class="left text-center">Hierarchy</div>
            </div>
            <div class="col-6">
              <div class="right text-center">Level</div>
            </div>
          </div>
          <div class="row ifl-section">
            <div class="col-6">
              <div class="check-wrap">
                <fin-checkbox [(model)]="ifl_switch_ibe" label="Internal Business Entity"
                              (modelChange)="iflChange('ibe')" [disabled]="BeIflDisabled"></fin-checkbox>
              </div>
              <div class="check-wrap">
                <fin-checkbox [(model)]="ifl_switch_p" label="Product" (modelChange)="iflChange('p')" [disabled]="ProductIflDisabled"></fin-checkbox>
              </div>
              <div class="check-wrap">
                <fin-checkbox [(model)]="ifl_switch_le" label="Legal Entity" (modelChange)="iflChange('le')" [disabled]="LegalIflDisabled"></fin-checkbox>
              </div>
              <div class="check-wrap">
                <fin-checkbox [(model)]="ifl_switch_s" label="Sales" (modelChange)="iflChange('s')" [disabled]="SalesIflDisabled"></fin-checkbox>
              </div>
              <div class="check-wrap">
                <fin-checkbox [(model)]="ifl_switch_scms" label="SCMS" (modelChange)="iflChange('scms')" [disabled]="ScmsIflDisabled"></fin-checkbox>
              </div>
            </div>
            <div class="col-6">
              <div class="sel-wrap">
                <cui-select name="ibeLevel" [(ngModel)]="sm.inputFilterLevel.internalBELevel" [fxShow]="ifl_switch_ibe" class="option"
                             [items]="ibe_items" optionsKey="name"optionsValue="value" empty="true"></cui-select>
              </div>
              <div class="sel-wrap">
                <cui-select name="productLevel" [(ngModel)]="sm.inputFilterLevel.productLevel" [fxShow]="ifl_switch_p" class="option"
                            [items]="p_items" optionsKey="name" optionsValue="value" empty="true"></cui-select>
              </div>
              <div class="sel-wrap">
                <cui-select name="entityLevel" [(ngModel)]="sm.inputFilterLevel.entityLevel" [fxShow]="ifl_switch_le" class="option"
                            [items]="le_items" optionsKey="name" optionsValue="value" empty="true"></cui-select>
              </div>
              <div class="sel-wrap">
                <cui-select name="salesLevel" [(ngModel)]="sm.inputFilterLevel.salesLevel" [fxShow]="ifl_switch_s" class="option"
                            [items]="s_items" optionsKey="name" optionsValue="value" empty="true"></cui-select>
              </div>
              <div class="sel-wrap">
                <cui-select name="scmsLevel" [(ngModel)]="sm.inputFilterLevel.scmsLevel" [fxShow]="ifl_switch_scms" class="option"
                            [items]="scms_items" optionsKey="name" optionsValue="value" empty="true"></cui-select>
              </div>
            </div>
          </div>
        </fieldset>
      </div>

      <div class="col-lg-6 mm-right-side">
        <fieldset class="input-filter-level mm-fieldset">
          <legend>
            <fin-checkbox class="legend-checkbox" [(model)]="sm.indicators.manualMapping"
                          trueVal="Y" falseVal="N" (modelChange)="mmSelect()"></fin-checkbox>
            Manual Mapping
          </legend>

          <div [fxShow]="isManualMapping()">
            <div class="row half-padding">
              <div class="col-6">
                <div class="left text-center">Hierarchy</div>
              </div>
              <div class="col-6">
                <div class="right text-center">Level</div>
              </div>
            </div>
            <div class="row ifl-section">
              <div class="col-6">
                <div class="check-wrap">
                  <fin-checkbox [(model)]="mm_switch_ibe" label="Internal Business Entity"
                                (modelChange)="mmChange('ibe')" [disabled]="BeMmDisabled"></fin-checkbox>
                </div>
                <div class="check-wrap">
                  <fin-checkbox [(model)]="mm_switch_p" label="Product" (modelChange)="mmChange('p')" [disabled]="ProductMmDisabled"></fin-checkbox>
                </div>
                <div class="check-wrap">
                  <fin-checkbox [(model)]="mm_switch_le" label="Legal Entity" (modelChange)="mmChange('le')" [disabled]="LegalMmDisabled"></fin-checkbox>
                </div>
                <div class="check-wrap">
                  <fin-checkbox [(model)]="mm_switch_s" label="Sales" (modelChange)="mmChange('s')" [disabled]="SalesMmDisabled"></fin-checkbox>
                </div>
                <div class="check-wrap">
                  <fin-checkbox [(model)]="mm_switch_scms" label="SCMS" (modelChange)="mmChange('scms')" [disabled]="ScmsMmDisabled"></fin-checkbox>
                </div>
              </div>
              <div class="col-6">
                <div class="sel-wrap">
                  <cui-select name="ibeLevelMM" [(ngModel)]="sm.manualMapping.internalBELevel" [fxShow]="mm_switch_ibe" class="option"
                              [items]="ibe_items" optionsKey="name" optionsValue="value" empty="true"></cui-select>
                </div>
                <div class="sel-wrap">
                  <cui-select name="productLevelMM" [(ngModel)]="sm.manualMapping.productLevel" [fxShow]="mm_switch_p" class="option"
                              [items]="p_items" optionsKey="name" optionsValue="value" empty="true"></cui-select>
                </div>
                <div class="sel-wrap">
                  <cui-select name="entityLevelMM" [(ngModel)]="sm.manualMapping.entityLevel" [fxShow]="mm_switch_le" class="option"
                              [items]="le_items" optionsKey="name" optionsValue="value" empty="true"></cui-select>
                </div>
                <div class="sel-wrap">
                  <cui-select name="salesLevelMM" [(ngModel)]="sm.manualMapping.salesLevel" [fxShow]="mm_switch_s" class="option"
                              [items]="s_items" optionsKey="name" optionsValue="value" empty="true"></cui-select>
                </div>
                <div class="sel-wrap">
                  <cui-select name="scmsLevelMM" [(ngModel)]="sm.manualMapping.scmsLevel" [fxShow]="mm_switch_scms" class="option"
                              [items]="scms_items" optionsKey="name" optionsValue="value" empty="true"></cui-select>
                </div>
              </div>
            </div>
          </div>
        </fieldset>
      </div>

    </div>

    <div class="row">
      <div class="col-lg-6">
        <cui-select name="startMonth" [(ngModel)]="sm.startFiscalMonth" [items]="yearmos" label="Effective Month" empty="true"
                    [required]="true" optionsKey="fiscalMonthName" optionsValue="fiscalMonth"></cui-select>

        <cui-select name="processingTime" [(ngModel)]="sm.processingTime" [items]="timings" label="Processing Timing" empty="true"
                    optionsKey="name" optionsValue="value"></cui-select>

        <cui-select name="pnlnodeGrouping" [(ngModel)]="sm.pnlnodeGrouping" [items]="groupings" label="P&L Node Grouping" empty="true"
                    optionsKey="name" optionsValue="value"></cui-select>
      </div>
      <div class="col-lg-6">
        <cui-input type="text" *ngFor="let level of this.sm.reportingLevels; let idx=index;"
                   [(model)]="sm.reportingLevels[idx]"
                   [disabled]="disableReportingLevels[idx]" label="Reporting Level {{idx+1}}"></cui-input>
      </div>
    </div>

    <div class="row base-padding-top">
      <div class="col-lg-6">
        <fieldset class="rule-assoc">
          <legend>
        <span class="tooltip" data-balloon="Attach up to 5 rules" data-balloon-pos="up">
        <i class="icon-info-outline icon-small"></i>
          </span>
            Rule Association
          </legend>

          <div class="rule" *ngFor="let rule of sm.rules; let idx = index;">
            <cui-select name="rule" [(ngModel)]="sm.rules[idx]" class="rule-select" [items]="rules" empty="true" dropdownMaxHeight="300"
                        optionsKey="name" optionsValue="name"></cui-select>

            <i class="delete icon-exit-outline icon-small" [fxShow]="showDeleteRuleIcon()" (click)="removeRule(idx)"></i>
            <i class="add icon-add-outline icon-small" [fxShow]="showAddRuleIcon()" (click)="addRule(idx)"></i>
          </div>
        </fieldset>
      </div>
    </div>

    <div class="row">
      <div class="col-12">
        <div class="inline-check-row">
          <div class="form-group-check form-group-inline-30">
            <fin-checkbox label="Retained Earnings" [(model)]="sm.indicators.retainedEarnings" trueVal="Y"
                          falseVal="N"></fin-checkbox>
          </div>
          <div class="form-group-check form-group-inline-30">
            <fin-checkbox label="Transition" [(model)]="sm.indicators.transition" trueVal="Y" falseVal="N"></fin-checkbox>
          </div>
          <div class="form-group-check form-group-inline-30">
            <fin-checkbox label="Corporate Revenue" [(model)]="sm.indicators.corpRevenue" trueVal="Y"
                          falseVal="N"></fin-checkbox>
          </div>
          <div class="form-group-check form-group-inline-30">
            <fin-checkbox label="2 Tier" [(model)]="sm.indicators.twoTier" trueVal="Y" falseVal="N"></fin-checkbox>
          </div>
          <div class="form-group-check form-group-inline-30">
            <fin-checkbox label="Dual Gaap" [(model)]="sm.indicators.dualGaap" trueVal="Y" falseVal="N"></fin-checkbox>
          </div>
        </div>
      </div>
    </div>

    <div finAuth="super-user" class="fin-footer-buttons">
      <button type="submit" finErrorFlash cuiButton color="primary" (click)="submitForApproval()">Submit</button>
      <button type="button" cuiButton color="primary" (click)="saveToDraft()">Save Draft</button>
      <button type="button" cuiButton color="secondary" (click)="cancel()">Cancel</button>
      <button type="button" cuiButton color="secondary" (click)="reset()">Reset</button>
    </div>
  </form>
</div>
